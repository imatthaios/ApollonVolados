<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:ApollonVolados.Mobile.ViewModels"
    x:Class="ApollonVolados.Mobile.Views.NewsPage"
    x:DataType="vm:NewsViewModel"
    Title="Νέα"
    BackgroundColor="{StaticResource SurfaceColor}">

    <Grid>

        <CollectionView
            ItemsSource="{Binding Posts}"
            SelectionMode="Single"
            SelectionChanged="OnItemSelected"
            Margin="12"
            BackgroundColor="{StaticResource SurfaceColor}"
            ItemSizingStrategy="MeasureFirstItem">

            <CollectionView.ItemsLayout>
                <GridItemsLayout 
                    Orientation="Vertical"
                    Span="{OnIdiom Phone=1, Tablet=2, Desktop=3}" 
                    VerticalItemSpacing="16"
                    HorizontalItemSpacing="16" />
            </CollectionView.ItemsLayout>

            <CollectionView.EmptyView>
                <VerticalStackLayout Spacing="16" Padding="12">
                    <Border
                        HeightRequest="96"
                        StrokeShape="RoundRectangle 18"
                        BackgroundColor="{StaticResource SkeletonColor}" />
                    <Border
                        HeightRequest="96"
                        StrokeShape="RoundRectangle 18"
                        BackgroundColor="{StaticResource SkeletonColor}" />
                    <Border
                        HeightRequest="96"
                        StrokeShape="RoundRectangle 18"
                        BackgroundColor="{StaticResource SkeletonColor}" />
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="vm:NewsItemViewModel">
                    <Border
                        BackgroundColor="{StaticResource SurfaceColor}"
                        Padding="14"
                        StrokeShape="RoundRectangle 18">

                        <Border.Shadow>
                            <Shadow
                                Brush="#14000000"
                                Offset="0,3"
                                Radius="8" />
                        </Border.Shadow>

                        <Grid ColumnDefinitions="96,*" ColumnSpacing="14">

                            <Border
                                HeightRequest="88"
                                WidthRequest="88"
                                StrokeShape="RoundRectangle 12"
                                BackgroundColor="{StaticResource SkeletonColor}">

                                <Image
                                    Source="{Binding ImageUrl}"
                                    Aspect="AspectFill" />
                            </Border>

                            <Grid Grid.Column="1" RowDefinitions="*,Auto">

                                <Label
                                    Text="{Binding TitleText}"
                                    Style="{StaticResource ArticleTitle}"
                                    LineBreakMode="TailTruncation"
                                    MaxLines="3" />

                                <Label
                                    Grid.Row="1"
                                    Text="{Binding PublishedDateText}"
                                    Style="{StaticResource ArticleMeta}"
                                    HorizontalOptions="End"
                                    Margin="0,8,0,0" />
                            </Grid>

                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

        <Grid
            IsVisible="{Binding IsBusy}"
            BackgroundColor="#80FFFFFF">

            <ActivityIndicator
                IsRunning="True"
                Color="{StaticResource PrimaryColor}"
                WidthRequest="48"
                HeightRequest="48"
                HorizontalOptions="Center"
                VerticalOptions="Center" />
        </Grid>

    </Grid>
</ContentPage>