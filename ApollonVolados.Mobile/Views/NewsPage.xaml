<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="ApollonVolados.Mobile.Views.NewsPage"
    Title="Νέα"
    BackgroundColor="{StaticResource SurfaceColor}">

    <CollectionView
        ItemsSource="{Binding Posts}"
        SelectionMode="Single"
        SelectionChanged="OnItemSelected"
        Margin="12"
        BackgroundColor="{StaticResource SurfaceColor}">

        <!-- SKELETON LOADING -->
        <CollectionView.EmptyView>
            <VerticalStackLayout Spacing="12">
                <Border HeightRequest="90" Opacity="0.4" />
                <Border HeightRequest="90" Opacity="0.4" />
                <Border HeightRequest="90" Opacity="0.4" />
            </VerticalStackLayout>
        </CollectionView.EmptyView>

        <CollectionView.ItemTemplate>
            <DataTemplate>
                <Border
                    x:Name="ArticleCard"
                    BackgroundColor="{StaticResource SurfaceColor}"
                    Padding="12"
                    Margin="0,10"
                    StrokeShape="RoundRectangle 14">

                    <!-- SUBTLE SHADOW -->
                    <Border.Shadow>
                        <Shadow Brush="#0F000000" Offset="0,2" Radius="6" />
                    </Border.Shadow>

                    <Grid ColumnDefinitions="90,*" ColumnSpacing="12">

                        <!-- IMAGE WITH ROUNDED MASK -->
                        <Border
                            HeightRequest="80"
                            WidthRequest="80"
                            StrokeShape="RoundRectangle 10"
                            BackgroundColor="#EEE">

                            <Image
                                Source="{Binding ImageUrl}"
                                Aspect="AspectFill"/>
                        </Border>

                        <!-- CONTENT -->
                        <Grid Grid.Column="1" RowDefinitions="*,Auto">

                            <!-- TITLE -->
                            <Label
                                Text="{Binding TitleText}"
                                Style="{StaticResource ArticleTitle}"
                                LineBreakMode="TailTruncation"
                                MaxLines="3">

                                <!-- DROP CAP FOR FIRST ITEM -->
                                <Label.Triggers>
                                    <DataTrigger
                                        TargetType="Label"
                                        Binding="{Binding IsFirst}"
                                        Value="True">
                                        <Setter Property="FontSize" Value="20"/>
                                        <Setter Property="CharacterSpacing" Value="1.5"/>
                                    </DataTrigger>
                                </Label.Triggers>
                            </Label>

                            <!-- DATE -->
                            <Label
                                Grid.Row="1"
                                Text="{Binding PublishedDateText}"
                                Style="{StaticResource ArticleMeta}"
                                HorizontalOptions="End"
                                Margin="0,6,0,0"/>
                        </Grid>

                    </Grid>
                </Border>
            </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>
</ContentPage>
